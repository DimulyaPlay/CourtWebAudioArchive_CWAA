# REST API Documentation

## Overview
Этот API предоставляет доступ к информации о заказных отправлениях, их отслеживанию и электронной форме уведомлений о вручении. База данных содержит данные о почтовых отправлениях (`PostalOrder`) и пакетах (`FinalizedBatch`).

### Базовый URL
`https://<server-address>/api/`

### Содержание

1. [Главная страница](#1-Главная-страница)
2. [Получение списка почтовых отправлений](#2-Получение-списка-почтовых-отправлений)
3. [Получение данных отслеживания отправления](#3-Получение-данных-отслеживания-отправления)
4. [Получение изображения Eнот (e-note)](#4-Получение-изображения-eнот-e-note)

---

## 1. Главная страница

### `GET /`
Отображение главной страницы интерфейса для отслеживания заказных отправлений.

- **Описание**: Этот маршрут загружает HTML-шаблон `index.html`, который служит основной страницей для интерфейса отслеживания.
- **Ответ**:
  - **Код 200**: HTML-шаблон `index.html` с заголовком `Отслеживание заказных писем`.

---

## 2. Получение списка почтовых отправлений

### `GET /api/get-postal-orders`
Получение списка почтовых отправлений с возможностью фильтрации и пагинации.

- **Описание**: Возвращает список почтовых отправлений с поддержкой фильтрации по комментарию, штрихкоду, полному имени и адресу получателя.

- **Параметры запроса**:
  - `page` (int): Номер страницы для пагинации (по умолчанию 1).
  - `search` (string): Фильтр ИЛИ по всем полям. Если есть этот параметр, следующие параметры не используются.
  - `search_comment` (string): Фильтр по комментарию отправления.
  - `search_barcode` (string): Фильтр по штрихкоду отправления.
  - `search_full_name` (string): Фильтр по полному имени получателя.
  - `search_address` (string): Фильтр по адресу получателя.

- **Пример запроса**:
- **GET** /api/get-postal-orders?page=1&search_comment=important&search_barcode=AB123

- **Ответ**:
- **Код 200**: JSON-объект со списком отправлений, включая данные пагинации.
  ```json
  {
    "orders": [
      {
        "id": 1,
        "comment": "Priority",  
        "address": "123 Main St",
        "fullName": "John Doe",
        "last_track": "Delivered от 01.10.2023 15:30",
        "sent_date": "01.10.2023 10:00",
        "enot_loaded": 1
      },
      ...
    ],
    "total_pages": 5,
    "current_page": 1,
    "start_index_pages": 1,
    "end_index_pages": 4
  }
  ```

---

## 3. Получение данных отслеживания отправления

### `GET /api/get-tracking`
Получение страницы с данными трекинга для печати.

- **Описание**: Возвращает HTML-шаблон `tracking_form.html` с данными отслеживания для отображения и печати.

- **Параметры запроса**:
- `order_id` (int): Уникальный идентификатор отправления.

- **Пример запроса**: 
- **GET** /api/get-tracking?order_id=1
- **Ответ**:
- **Код 200**: HTML-шаблон `tracking_form.html` с данными для печати, включая:
  - `barcode`: Штрихкод отправления.
  - `current_time`: Время запроса.
  - `mailtype`: Тип отправления.
  - `otpravitel`: Информация об отправителе.
  - `poluchatel`: Информация о получателе.
  - `data`: История отслеживания.
- **Код 404**: Если отправление не найдено.
  ```json
  {
    "error": "Order not found"
  }
  ```

---

## 4. Получение изображения Eнот (e-note)

### `GET /api/get-enot`
Получение изображения электронного уведомления о вручении для отправления.

- **Описание**: Этот маршрут возвращает изображение `JPEG`, содержащее e-note, связанное с отправлением.

- **Пример запроса**:
- **GET** /api/get-enot?order_id=1

- **Ответ**:
- **Код 200**: Изображение `JPEG`, соответствующее e-note отправления.
- **Код 404**: Ошибка, если отправление или e-note не найден.
  ```json
  {
    "error": "Order not found"
  }
  ```
---
## 5. Получение даты и времени пополнения базы отслеживания

### `GET /get-db-update-date`
Получение даты и времени пополнения базы данных

- **Описание**: Этот маршрут возвращает дату и время обновления базы данных отсдеживания в формате "ДД.ММ.ГГГГ ЧЧ:ММ".


- **Пример запроса**:
- **GET** /get-db-update-date

- **Ответ**:
  ```json
  {
    "update_date": "12.34.4567 89:01"
  }
  ```
- **Код 404**: Ошибка, если БД найдена.
  ```json
  {
    "error": "Database not found"
  }
  ```

---
## 6. Получение статистики отправлений за указанный период

### `GET /get-stat`
Получение статистики отправлений за указанный период

- **Описание**: Mаршрут возвращает количество отправлений каждого вида за указанный период.
- 
- **Параметры запроса**:
  - `start_date` (string): Дата начала отсчета в формате YYYY-MM-DD
  - `end_date` (string): Дата конца отсчета в формате YYYY-MM-DD

- **Пример запроса**:
- **GET** /api/get-stat?start_date=2024-01-01&end_date=2024-01-31

- **Ответ**:
  ```json
  {
    "update_date": "12.34.4567 89:01"
  }
  ```
- **Код 400**: Ошибка, если не переданы даты или переданыне в формате YYYY-MM-DD
  ```json
  {
    "error": "start_date and end_date parameters are required"
  }
   {
    "error": "Invalid date format. Use YYYY-MM-DD"
  } 

- **Код 500**: Ошибка бэкенда.
  ```json
  {
    "error": "Internal exception text"
  }
  ```

